- hosts: localhost
  become: yes
  vars:
    - fedora_version: 37

  tasks:
    - name: Remove clutter.
      dnf:
        name: "{{ packages }}"
        state: removed
      vars:
        packages:
          - cheese
          - libreoffice-calc
          - libreoffice-impress
          - gnome-contacts
          - gnome-maps
          - gnome-photos
          - gnome-tour
          - gnome-weather
          - simple-scan
          - totem

    - name: Update system packages.
      dnf:
        name: '*'
        state: latest

    - name: Enable RPM Fusion repository.
      dnf:
        name: "{{ packages }}"
        state: latest
        disable_gpg_check: True
      vars:
        packages: 
          - https://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-{{ fedora_version }}.noarch.rpm
          - https://download1.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-{{ fedora_version }}.noarch.rpm

    - name: Install system packages.
      dnf:
        name: "{{ packages }}"
        state: latest
      vars:
        packages:  # Chrome, Firefox...
          - dnf-plugins-core
          - gnome-tweaks
          - gnome-extensions-app
          - snapd
          - vlc
          - transmission
          - geary
          - chromium

    # Using shell command as workaround because there is no Ansible plugin for dnf config-manageer.
    # https://github.com/ansible/ansible/issues/46963
    - name: Add Docker remote repository to dnf.
      command: dnf config-manager --add-repo https://download.docker.com/linux/fedora/docker-ce.repo

    - name: Create symlink to support snap classic.  # Needed to install VS Code.
      command: ln -sf /var/lib/snapd/snap /snap

    - name: Install VS Code.
      community.general.snap:
        name:
          - code
        classic: true

    - name: Install Postman.
      community.general.snap:
        name:
          - core18
          - postman

    - name: Install Docker.
      dnf:
        name: "{{ packages }}"
        state: latest
      vars:
        packages:
          - docker-ce
          - docker-ce-cli
          - containerd.io
          - docker-compose-plugin
